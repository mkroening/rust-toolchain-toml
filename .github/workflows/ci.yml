on: [push]

defaults:
    run:
      shell: bash

jobs:
  test:
    strategy:
      matrix:
        os: [ubuntu-latest, ubuntu-24.04-arm, macos-latest, windows-latest]
    runs-on: ${{ matrix.os }}
    steps:
      - uses: actions/checkout@v4
      - run: cp rust-toolchain-full.toml rust-toolchain.toml
      - id: toolchain-full
        uses: ./
      - run: |
          [[ ${{ steps.toolchain-full.outputs.cachekey }} == 20221231574b ]]
          [[ ${{ steps.toolchain-full.outputs.name }} == nightly-2023-01-01 ]]
      - id: toolchain-full-nightly
        uses: ./
        with:
          toolchain: nightly
      - run: |
          [[ ${{ steps.toolchain-full-nightly.outputs.name }} == nightly ]]
      - run: cp rust-toolchain-empty.toml rust-toolchain.toml
      - id: toolchain-empty
        uses: ./
      - run: |
          [[ ${{ steps.toolchain-empty.outputs.name }} == stable ]]
      - run: cp rust-toolchain-full.toml .github/rust-toolchain.toml
      - uses: ./
        with:
          toolchain-file: '.github/rust-toolchain.toml'
